<!doctype html>
<html lang="sl" class="dark">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>PDFme Editor - Login</title>
  <style>
    /* Shadcn/ui inspired design system */
    :root {
      --background: 0 0% 100%;
      --foreground: 222.2 84% 4.9%;
      --card: 0 0% 100%;
      --card-foreground: 222.2 84% 4.9%;
      --primary: 221.2 83.2% 53.3%;
      --primary-foreground: 210 40% 98%;
      --secondary: 210 40% 96.1%;
      --secondary-foreground: 222.2 47.4% 11.2%;
      --muted: 210 40% 96.1%;
      --muted-foreground: 215.4 16.3% 46.9%;
      --accent: 210 40% 96.1%;
      --accent-foreground: 222.2 47.4% 11.2%;
      --destructive: 0 84.2% 60.2%;
      --destructive-foreground: 210 40% 98%;
      --border: 214.3 31.8% 91.4%;
      --input: 214.3 31.8% 91.4%;
      --ring: 221.2 83.2% 53.3%;
      --radius: 0.5rem;
    }

    .dark {
      --background: 222.2 84% 4.9%;
      --foreground: 210 40% 98%;
      --card: 222.2 84% 4.9%;
      --card-foreground: 210 40% 98%;
      --primary: 217.2 91.2% 59.8%;
      --primary-foreground: 222.2 47.4% 11.2%;
      --secondary: 217.2 32.6% 17.5%;
      --secondary-foreground: 210 40% 98%;
      --muted: 217.2 32.6% 17.5%;
      --muted-foreground: 215 20.2% 65.1%;
      --accent: 217.2 32.6% 17.5%;
      --accent-foreground: 210 40% 98%;
      --destructive: 0 62.8% 30.6%;
      --destructive-foreground: 210 40% 98%;
      --border: 217.2 32.6% 17.5%;
      --input: 217.2 32.6% 17.5%;
      --ring: 224.3 76.3% 48%;
    }

    * { box-sizing: border-box; margin: 0; padding: 0; }

    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
      background: hsl(var(--background));
      color: hsl(var(--foreground));
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 20px;
      background-image:
        radial-gradient(at 27% 37%, hsla(215, 98%, 61%, 0.1) 0px, transparent 0%),
        radial-gradient(at 97% 21%, hsla(125, 98%, 72%, 0.05) 0px, transparent 50%),
        radial-gradient(at 52% 99%, hsla(354, 98%, 61%, 0.05) 0px, transparent 50%),
        radial-gradient(at 10% 29%, hsla(256, 96%, 67%, 0.1) 0px, transparent 50%),
        radial-gradient(at 97% 96%, hsla(38, 60%, 74%, 0.05) 0px, transparent 50%),
        radial-gradient(at 33% 50%, hsla(222, 67%, 73%, 0.1) 0px, transparent 50%),
        radial-gradient(at 79% 53%, hsla(343, 68%, 79%, 0.05) 0px, transparent 50%);
    }

    .login-card {
      background: hsl(var(--card));
      border: 1px solid hsl(var(--border));
      border-radius: var(--radius);
      box-shadow: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1);
      padding: 48px;
      width: 100%;
      max-width: 420px;
      animation: slideUp 0.4s ease-out;
    }

    @keyframes slideUp {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .logo {
      text-align: center;
      margin-bottom: 32px;
    }

    .logo-icon {
      width: 56px;
      height: 56px;
      background: hsl(var(--primary));
      border-radius: var(--radius);
      display: inline-flex;
      align-items: center;
      justify-content: center;
      font-size: 28px;
      margin-bottom: 16px;
    }

    h1 {
      font-size: 24px;
      font-weight: 600;
      color: hsl(var(--foreground));
      text-align: center;
      margin-bottom: 8px;
      letter-spacing: -0.025em;
    }

    .subtitle {
      color: hsl(var(--muted-foreground));
      text-align: center;
      font-size: 14px;
      margin-bottom: 32px;
    }

    .form-group {
      margin-bottom: 20px;
    }

    label {
      display: block;
      font-size: 14px;
      font-weight: 500;
      color: hsl(var(--foreground));
      margin-bottom: 8px;
    }

    input {
      width: 100%;
      padding: 10px 12px;
      background: hsl(var(--background));
      border: 1px solid hsl(var(--input));
      border-radius: calc(var(--radius) - 2px);
      font-size: 14px;
      color: hsl(var(--foreground));
      transition: all 0.2s;
    }

    input:focus {
      outline: none;
      border-color: hsl(var(--ring));
      box-shadow: 0 0 0 3px hsl(var(--ring) / 0.1);
    }

    input::placeholder {
      color: hsl(var(--muted-foreground));
    }

    .btn {
      width: 100%;
      padding: 10px 16px;
      background: hsl(var(--primary));
      color: hsl(var(--primary-foreground));
      border: none;
      border-radius: calc(var(--radius) - 2px);
      font-size: 14px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
    }

    .btn:hover {
      background: hsl(var(--primary) / 0.9);
    }

    .btn:active {
      transform: scale(0.98);
    }

    .btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
      transform: none;
    }

    .spinner {
      width: 16px;
      height: 16px;
      border: 2px solid hsl(var(--primary-foreground) / 0.3);
      border-radius: 50%;
      border-top-color: hsl(var(--primary-foreground));
      animation: spin 0.6s linear infinite;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    .error {
      background: hsl(var(--destructive) / 0.1);
      border: 1px solid hsl(var(--destructive) / 0.3);
      color: hsl(var(--destructive-foreground));
      padding: 12px 16px;
      border-radius: calc(var(--radius) - 2px);
      font-size: 14px;
      margin-bottom: 20px;
      display: none;
      animation: shake 0.4s;
    }

    @keyframes shake {
      0%, 100% { transform: translateX(0); }
      25% { transform: translateX(-10px); }
      75% { transform: translateX(10px); }
    }

    .error.show {
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .error-icon {
      font-size: 16px;
    }

    .btn-content {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
    }
  </style>
</head>
<body>
  <div class="login-card">
    <div class="logo">
      <div class="logo-icon">üìÑ</div>
      <h1>PDFme Editor</h1>
      <div class="subtitle">Sign in to access the editor</div>
    </div>

    <div id="error" class="error">
      <span class="error-icon">‚ö†Ô∏è</span>
      <span id="errorMessage"></span>
    </div>

    <form id="loginForm">
      <div class="form-group">
        <label for="username">Username</label>
        <input
          type="text"
          id="username"
          name="username"
          placeholder="Enter your username"
          autocomplete="username"
          required
          autofocus
        />
      </div>

      <div class="form-group">
        <label for="password">Password</label>
        <input
          type="password"
          id="password"
          name="password"
          placeholder="Enter your password"
          autocomplete="current-password"
          required
        />
      </div>

      <button type="submit" class="btn" id="loginBtn">
        <span class="btn-content">
          <span id="btnText">Sign in</span>
        </span>
      </button>
    </form>
  </div>

  <script>
    const form = document.getElementById('loginForm');
    const errorDiv = document.getElementById('error');
    const errorMessage = document.getElementById('errorMessage');
    const loginBtn = document.getElementById('loginBtn');
    const btnText = document.getElementById('btnText');
    const usernameInput = document.getElementById('username');
    const passwordInput = document.getElementById('password');

    function showError(message) {
      errorMessage.textContent = message;
      errorDiv.classList.add('show');
      setTimeout(() => {
        errorDiv.classList.remove('show');
      }, 5000);
    }

    function setLoading(isLoading) {
      loginBtn.disabled = isLoading;
      if (isLoading) {
        btnText.innerHTML = '<div class="spinner"></div><span>Signing in...</span>';
      } else {
        btnText.innerHTML = 'Sign in';
      }
    }

    form.addEventListener('submit', async (e) => {
      e.preventDefault();

      const username = usernameInput.value.trim();
      const password = passwordInput.value;

      if (!username || !password) {
        showError('Please enter username and password');
        return;
      }

      setLoading(true);

      try {
        // Create Basic Auth header
        const credentials = btoa(`${username}:${password}`);

        // Test authentication by calling a protected endpoint
        const response = await fetch('/api/health', {
          headers: {
            'Authorization': `Basic ${credentials}`
          }
        });

        if (response.ok) {
          // Store credentials in sessionStorage (will be cleared on browser close)
          sessionStorage.setItem('auth_credentials', credentials);

          // Redirect to main editor
          window.location.href = '/';
        } else if (response.status === 401) {
          showError('Invalid username or password');
        } else if (response.status === 429) {
          const text = await response.text();
          showError(text || 'Too many failed attempts. Please try again later.');
        } else {
          showError('Login failed. Please try again.');
        }
      } catch (err) {
        console.error('Login error:', err);
        showError('Connection error. Please check your internet connection.');
      } finally {
        setLoading(false);
      }
    });

    // Don't auto-verify credentials on page load to prevent infinite redirect loops
    // User must explicitly click "Sign in" button
  </script>
</body>
</html>
